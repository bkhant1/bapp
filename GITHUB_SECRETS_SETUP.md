# GitHub Secrets Setup Guide

## üîê Required GitHub Repository Secrets

You need to configure these secrets in your GitHub repository to make the CI/CD pipeline work.

### How to Access GitHub Secrets
1. Go to your GitHub repository: `https://github.com/bkhant1/bapp`
2. Click `Settings` tab
3. Click `Secrets and variables` ‚Üí `Actions`
4. Click `New repository secret`

### Required Secrets

#### 1. **GCP_PROJECT_ID**
- **Name:** `GCP_PROJECT_ID`
- **Value:** `bookexchange-1755188197`
- **Description:** Your Google Cloud project ID

#### 2. **GCP_SA_KEY**
- **Name:** `GCP_SA_KEY`
- **Value:** Complete contents of your `github-actions-key.json` file
- **Description:** Service account JSON key for authentication

**To get the value:**
```bash
cat github-actions-key.json
```
Copy the entire JSON object including the curly braces `{ ... }`

#### 3. **DATABASE_PASSWORD**
- **Name:** `DATABASE_PASSWORD`
- **Value:** A secure password for your PostgreSQL database
- **Description:** Database password (different from your local tfvars)

**Example secure password:** `MySecurePassword123!@#`

### Optional Secrets (Auto-generated by Terraform)

These will be created automatically, but you can set them manually if needed:

#### 4. **DATABASE_URL** (Optional)
- **Name:** `DATABASE_URL`
- **Value:** Will be auto-generated by Terraform
- **Format:** `postgresql://user:password@host:5432/database`

#### 5. **GCS_BUCKET_NAME** (Optional)
- **Name:** `GCS_BUCKET_NAME`
- **Value:** Will be auto-generated by Terraform with random suffix
- **Format:** `bookexchange-media-[random-suffix]`

## üöÄ Testing the Setup

After setting up the secrets:

1. **Commit and push your changes:**
   ```bash
   git add .
   git commit -m "Fix GitHub Actions authentication"
   git push origin main
   ```

2. **Check the Actions tab** in your GitHub repository to see the workflow run

3. **Expected workflow sequence:**
   - ‚úÖ Backend tests pass
   - ‚úÖ Frontend tests pass  
   - ‚úÖ Terraform applies infrastructure
   - ‚úÖ Docker images build and push
   - ‚úÖ Applications deploy to Cloud Run

## üîç Troubleshooting

### Common Issues:

**Issue:** `PROJECT_ID:` is empty
- **Solution:** Make sure `GCP_PROJECT_ID` secret is set correctly

**Issue:** Authentication failed
- **Solution:** Verify `GCP_SA_KEY` contains the complete JSON

**Issue:** Terraform state bucket errors
- **Solution:** Ensure billing is enabled on your GCP project

### Verifying Secrets
You can verify secrets are set by checking the Actions logs - they should show:
```
env:
  PROJECT_ID: bookexchange-1755188197  # ‚Üê Should not be empty
```

## üõ°Ô∏è Security Notes

- ‚úÖ Service account key is stored securely in GitHub secrets
- ‚úÖ Secrets are encrypted at rest
- ‚úÖ Local `github-actions-key.json` is in `.gitignore`
- ‚úÖ Database password is different for local vs production
- ‚ö†Ô∏è Never commit secrets to git history 